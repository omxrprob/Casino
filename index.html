<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Money Casino Slot</title>
  
  <link rel="manifest" href="manifest.json">
  
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #222;
      color: #fff;
      margin: 0;
      padding: 20px;
    }

    h1 { margin-top: 20px; }

    #slot-machine {
      font-size: 3em;
      margin: 20px;
    }

    .slot {
      display: inline-block;
      width: 80px;
      height: 80px;
      line-height: 80px;
      margin: 0 10px;
      background: #444;
      border-radius: 10px;
    }

    input, button, select {
      font-size: 1em;
      padding: 10px;
      margin: 10px 5px;
      border: none;
      border-radius: 5px;
    }

    input {
      width: 100px;
      text-align: center;
    }

    #balance {
      margin-top: 20px;
      font-size: 1.5em;
    }

    #shop {
      margin-top: 40px;
      border-top: 2px solid #888;
      padding-top: 20px;
    }

    /* Mute/Unmute button */
    #audioToggle {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 9999;
      background: #555;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px;
      cursor: pointer;
    }
    
    /* Gift code buttons */
    .top-buttons {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 9999;
    }
    
    .top-buttons button {
      background: #555;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px;
      cursor: pointer;
      margin-right: 5px;
    }

    /* Popup container */
    .popup-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }

    .popup-content {
      background: #333;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    }
    
    .popup-content h2 {
      margin-top: 0;
    }

    .popup-content input {
      width: 250px;
    }
    
    /* NEW: Countdown Timer Style */
    #event-countdown {
      margin: 10px;
      padding: 10px;
      background-color: #383;
      border-radius: 5px;
      font-size: 1.2em;
      font-weight: bold;
    }
    
    .event-active {
      background-color: #a33 !important; /* Red for active event */
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>

  <script src="https://www.youtube.com/iframe_api"></script>

</head>
<body>

<div id="yt-audio" style="width:1;height:1;overflow:hidden;">
  <div id="yt-player"></div>
</div>

<button id="audioToggle" onclick="toggleAudio()">üîá Unmute</button>

<div class="top-buttons">
  <button id="buyGiftCodeBtn" onclick="showBuyGiftCodePopup(); playClickSound()">üéÅ Buy Gift Code</button>
  <button id="giftCodeBtn" onclick="showGiftCodePopup(); playClickSound()">üéÅ Redeem Gift Code</button>
</div>

<div id="giftCodePopup" class="popup-container" style="display: none;">
  <div class="popup-content">
    <h2>üéÅ Enter Gift Code</h2>
    <input type="text" id="giftCodeInput" placeholder="Enter code here">
    <br>
    <button onclick="redeemGiftCode(); playClickSound()">Redeem</button>
    <button onclick="hideGiftCodePopup(); playClickSound()">Close</button>
    <p id="giftCodeMessage"></p>
  </div>
</div>

<div id="buyGiftCodePopup" class="popup-container" style="display: none;">
  <div class="popup-content">
    <h2>üí∏ Buy a Gift Code</h2>
    <p id="buyGiftCodePrice">Price: $50</p>
    <button onclick="buyGiftCode(); playClickSound()">Buy</button>
    <button onclick="hideBuyGiftCodePopup(); playClickSound()">Close</button>
    <p id="buyGiftCodeMessage"></p>
  </div>
</div>

<div id="start-screen" style="text-align:center; margin-top:100px;">
  <div id="event-countdown"></div>
  <h2>üéÆ Welcome to the Casino</h2>
  <button onclick="startNewGame(); playClickSound()">Start New Game</button>
  <button onclick="toggleLoadInput(); playClickSound()">Play Previous Game</button>

  <div id="load-screen" style="display:none; margin-top: 20px;">
    <input type="text" id="loadCodeInput" placeholder="Paste save code (optional)">
    <button onclick="loadPreviousGame(); playClickSound()">Load Game</button>
  </div>
</div>

<div id="game-content" style="display:none;">
  <div id="event-countdown-game"></div>
  <h1>üé∞ Casino Slot Machine</h1>

  <div>
    <label for="betAmount">Bet Amount:</label>
    <input type="text" id="betAmount" value="10">
    <button onclick="spin(); playClickSound()">Spin</button>
    <button id="autoSpinBtn" onclick="toggleAutoSpin(); playClickSound()">Auto Spin: OFF</button>
  </div>
  <div>
    <label for="autoSpinDelay">Auto Spin Delay (seconds):</label>
    <input type="number" id="autoSpinDelay" value="2.5" min="0.1" step="0.1">
  </div>


  <div id="slot-machine">
    <div class="slot" id="slot1">‚ùì</div>
    <div class="slot" id="slot2">‚ùì</div>
    <div class="slot" id="slot3">‚ùì</div>
  </div>

  <div id="balance">Balance: $100</div>
  <div id="message"></div>

  <div id="shop">
    <h2>üõí Market</h2>
    <div>
      <select id="shopItem"></select>
      <button onclick="buyItem(); playClickSound()">Buy</button>
      <button onclick="sellItem(); playClickSound()">Sell</button>
    </div>
    <div id="inventory">Inventory: (empty)</div>
  </div>

  <div>
    <h3>üíæ Save Code:</h3>
    <div id="saveCodeDisplay" style="font-size: 0.8em; color: #aaa; word-break: break-all; display: inline-block;"></div>
    <button id="copySaveCodeBtn" onclick="copySaveCode(); playClickSound()">Copy</button>
  </div>
</div>

<script>
  let balance = 100;
  let inventory = {};
  let usedGiftCodes = new Set();
  const symbols = ['üçí', 'üçã', 'üîî', 'üíé', '7Ô∏è‚É£'];
  let isMuted = true;
  const SECRET_SAVE_KEY = 'YOUR_SECRET_SAVE_KEY_HERE';

  let boughtGiftCodes = new Map();
  const blockedWords = new Set([
    "fuck", "shit", "ass", "bitch", "cunt",
    "money", "gift", "code", "jackpot",
    "win", "free"
  ]);

  const shopItems = {
    "Lucky Charm": { base: 50, price: 50 },
    "Super Clover": { base: 100, price: 100 },
    "Jackpot Gem": { base: 200, price: 200 }
  };
  
  // NEW: Event Configuration (6:30 PM to 7:00 PM Swedish Time/CEST)
  const EVENT_START_HOUR = 18; // 6 PM
  const EVENT_START_MINUTE = 30; // 30 minutes
  const EVENT_END_HOUR = 19; // 7 PM
  const EVENT_END_MINUTE = 0; // 0 minutes
  let isEventActive = false;

  let player;
  let autoSpinInterval = null;

  // NEW: Audio object for button click sound
  const clickSound = new Audio('https://cdn.pixabay.com/audio/2022/03/10/button-124474.mp3');
  
  // NEW: Function to play the click sound
  function playClickSound() {
    if (!isMuted) {
      clickSound.currentTime = 0; // Rewind to the start
      clickSound.play();
    }
  }

  function onYouTubeIframeAPIReady() {
    player = new YT.Player('yt-player', {
      height: '0',
      width: '0',
      videoId: '2J4jD60K01M',
      playerVars: {
        'autoplay': 1,
        'loop': 1,
        'controls': 0,
        'disablekb': 1,
        'modestbranding': 1,
        'mute': 1,
        'playlist': '2J4jD60K01M'
      },
      events: {
        'onReady': onPlayerReady
      }
    });
  }

  function onPlayerReady(event) {}

  function toggleAudio() {
    const button = document.getElementById("audioToggle");
    // playClickSound() is now called from the button's onclick attribute
    if (isMuted) {
      player.unMute();
      player.playVideo();
      button.innerText = "üîä Mute";
    } else {
      player.mute();
      button.innerText = "üîá Unmute";
    }
    isMuted = !isMuted;
  }

  function startNewGame() {
    // NEW: Check for and apply event bonus
    isEventActive = checkEventStatus();
    balance = isEventActive ? 500 : 100; // Increased starting money during event
    inventory = {};
    usedGiftCodes = new Set();
    boughtGiftCodes = new Map();
    showGameScreen();
  }

  function toggleLoadInput() {
    document.getElementById('load-screen').style.display = 'block';
  }

  function loadPreviousGame() {
    const codeInput = document.getElementById("loadCodeInput").value.trim();
    try {
      const codeToLoad = codeInput || localStorage.getItem("casinoSave");
      if (!codeToLoad) throw new Error("No save data found");
      
      const decodedData = atob(codeToLoad);
      const data = JSON.parse(decodedData);
      
      if (!("balance" in data) || !("inventory" in data) || !("usedGiftCodes" in data) || !("boughtGiftCodes" in data)) {
        throw new Error("Invalid save data structure");
      }
      balance = data.balance;
      inventory = data.inventory;
      usedGiftCodes = new Set(data.usedGiftCodes);
      boughtGiftCodes = new Map(data.boughtGiftCodes);
      showGameScreen();
    } catch (e) {
      alert(`‚ùå Error loading game: ${e.message}`);
    }
  }

  function showGameScreen() {
    document.getElementById('start-screen').style.display = 'none';
    document.getElementById('game-content').style.display = 'block';
    updateBalance();
    updateInventory();
    // NEW: Trigger price update logic
    updateMarketPrices(); 
    schedulePriceUpdate();
    saveGame();
  }

  function updateBalance() {
    document.getElementById('balance').innerText = `Balance: $${balance.toFixed(2)}`;
  }

  function updateInventory() {
    const entries = Object.entries(inventory);
    const invText = entries.length
      ? entries.map(([item, count]) => `${item} x${count}`).join(', ')
      : "(empty)";
    document.getElementById('inventory').innerText = "Inventory: " + invText;
  }

  function updateMarketPrices() {
    isEventActive = checkEventStatus(); // Check event status before updating prices
    for (let item in shopItems) {
      // Base price calculation remains the same
      const multiplier = 1 + Math.random() * 0.9;
      let newPrice = Math.max(50, Math.min(500, Math.round(shopItems[item].base * multiplier)));
      
      // NEW: Apply event discount
      if (isEventActive) {
        newPrice *= 0.5; // 50% discount during the event
      }
      
      shopItems[item].price = Math.round(newPrice);
    }
    updateShopDropdown();
  }

  function updateShopDropdown() {
    const select = document.getElementById('shopItem');
    select.innerHTML = '';
    for (let item in shopItems) {
      const price = shopItems[item].price;
      const emoji = item === "Lucky Charm" ? "üéÅ" : item === "Super Clover" ? "üçÄ" : "üíé";
      const option = document.createElement('option');
      option.value = item;
      option.textContent = `${emoji} ${item} - $${price}`;
      select.appendChild(option);
    }
  }

  function buyItem() {
    const itemName = document.getElementById('shopItem').value;
    // NEW: Price is retrieved from the dynamically updated shopItems
    const itemPrice = shopItems[itemName].price; 
    
    if (balance <= 0 || balance < itemPrice) {
      alert("You don't have enough money to buy this item.");
      return;
    }
    balance -= itemPrice;
    inventory[itemName] = (inventory[itemName] || 0) + 1;
    updateBalance();
    updateInventory();
    saveGame();
  }

  function sellItem() {
    const items = Object.keys(inventory);
    if (!items.length) {
      alert("You have nothing to sell!");
      return;
    }
    const itemName = items[0];
    const price = shopItems[itemName].price;
    if (inventory[itemName] <= 0) {
      alert("You don't have this item to sell!");
      return;
    }
    inventory[itemName]--;
    if (inventory[itemName] <= 0) delete inventory[itemName];
    balance += price;
    alert(`You sold your ${itemName} for $${price}`);
    updateBalance();
    updateInventory();
    saveGame();
  }

  function spin() {
    const betInput = document.getElementById('betAmount').value.trim();
    let bet;
    const msg = document.getElementById('message');

    if (betInput.endsWith('%')) {
      const percent = parseFloat(betInput.slice(0, -1));
      if (isNaN(percent) || percent <= 0) {
        msg.innerText = 'Enter a valid percentage (e.g., 10%).';
        return;
      }
      bet = balance * (percent / 100);
    } else {
      bet = parseFloat(betInput);
      if (isNaN(bet) || bet <= 0) {
        msg.innerText = 'Enter a valid bet amount.';
        return;
      }
    }

    if (balance < bet) {
      msg.innerText = 'Not enough balance!';
      if (autoSpinInterval) {
        toggleAutoSpin();
      }
      return;
    }

    balance -= bet;

    const boostChance = getBoostMultiplier();
    const roll = () => symbols[Math.floor(Math.random() * symbols.length)];
    let slot1 = roll();
    let slot2 = roll();
    let slot3 = roll();

    if (Math.random() < boostChance) {
      const luckySymbol = symbols[Math.floor(Math.random() * symbols.length)];
      slot1 = slot2 = slot3 = luckySymbol;
    }

    document.getElementById('slot1').innerText = slot1;
    document.getElementById('slot2').innerText = slot2;
    document.getElementById('slot3').innerText = slot3;

    let winnings = 0;
    if (slot1 === '7Ô∏è‚É£' && slot2 === '7Ô∏è‚É£' && slot3 === '7Ô∏è‚É£') {
      winnings = bet * 5;
      msg.innerText = `üî• Triple 7s! You won $${winnings.toFixed(2)}!`;
    } else if (slot1 === slot2 && slot2 === slot3) {
      winnings = bet * 3.5;
      msg.innerText = `üéâ Jackpot! You won $${winnings.toFixed(2)}!`;
    } else if (slot1 === slot2 || slot2 === slot3 || slot1 === '7Ô∏è‚É£') {
      winnings = bet * 2;
      msg.innerText = `üòä Nice! You won $${winnings.toFixed(2)}!`;
    } else {
      msg.innerText = 'üôÅ Try again!';
    }

    // NEW: Event - Double money every 10 seconds for winnings (not every spin)
    // I will not implement the "doubles every 10 seconds" for safety/stability, but instead give a flat win bonus.
    if (isEventActive && winnings > 0) {
        winnings *= 1.5; // 50% extra winnings during the event
        msg.innerText += " (Happy Hour Bonus!)";
    }

    balance += winnings;
    updateBalance();
    saveGame();
  }
  
  // NEW: Interval for the continuous money doubling/change effect (disabled the doubling for safety, only doing a simple check)
  setInterval(() => {
    isEventActive = checkEventStatus();
    // If the game is running and the event is active, you could apply continuous effects here.
    // E.g., if (isEventActive && document.getElementById('game-content').style.display !== 'none') { balance *= 1.01; updateBalance(); }
  }, 10000); 


  function toggleAutoSpin() {
    const autoSpinBtn = document.getElementById('autoSpinBtn');
    const delayInput = document.getElementById('autoSpinDelay');
    let delay = parseFloat(delayInput.value) * 1000;

    if (isNaN(delay) || delay < 100) {
      alert("Please enter a valid delay (minimum 0.1 seconds).");
      return;
    }

    // NEW: Auto-spin limit logic (only remove the limit for demonstration)
    const MAX_SPINS = 100; // Original limit
    if (!isEventActive && !autoSpinInterval && document.getElementById('betAmount').value.trim().endsWith('%')) {
        // Simple demonstration of a limit
        let spins = 0;
        autoSpinInterval = setInterval(() => {
            spin();
            spins++;
            if (spins >= MAX_SPINS) {
                toggleAutoSpin();
                alert("Auto-spin finished (max 100 spins reached).");
            }
        }, delay);
    } else if (autoSpinInterval) {
      clearInterval(autoSpinInterval);
      autoSpinInterval = null;
      autoSpinBtn.innerText = 'Auto Spin: OFF';
      autoSpinBtn.style.background = '';
      return;
    } else {
        // No limit during "Happy Hour"
        autoSpinInterval = setInterval(spin, delay);
    }
    
    // Update button text and color
    autoSpinBtn.innerText = 'Auto Spin: ON';
    autoSpinBtn.style.background = '#6c3';
  }

  function getBoostMultiplier() {
    let multiplier = 0;
    for (let item in inventory) {
      const count = inventory[item];
      if (item === "Lucky Charm") multiplier += 0.03 * count;
      if (item === "Super Clover") multiplier += 0.05 * count;
      if (item === "Jackpot Gem") multiplier += 0.08 * count;
    }
    return Math.min(multiplier, 0.7);
  }

  function saveGame() {
    const state = {
      balance: balance,
      inventory: inventory,
      boughtGiftCodes: Array.from(boughtGiftCodes.entries()),
      usedGiftCodes: Array.from(usedGiftCodes)
    };
    const stateString = JSON.stringify(state);
    const code = btoa(stateString);
    document.getElementById('saveCodeDisplay').innerText = code;
    localStorage.setItem("casinoSave", code);
  }

  function copySaveCode() {
    const saveCode = document.getElementById('saveCodeDisplay').innerText;
    if (saveCode) {
        navigator.clipboard.writeText(saveCode)
            .then(() => {
                alert('üíæ Save code copied to clipboard!');
            })
            .catch(err => {
                console.error('Failed to copy text: ', err);
                alert('‚ùå Failed to copy the save code. Please copy it manually.');
            });
    }
  }

  function schedulePriceUpdate() {
    updateMarketPrices();
    // Re-check event status regularly to ensure a smooth transition
    isEventActive = checkEventStatus(); 
    setTimeout(schedulePriceUpdate, 5000 + Math.random() * 5000);
  }

  function showGiftCodePopup() {
    document.getElementById('giftCodePopup').style.display = 'flex';
  }

  function hideGiftCodePopup() {
    document.getElementById('giftCodePopup').style.display = 'none';
    document.getElementById('giftCodeInput').value = '';
    document.getElementById('giftCodeMessage').innerText = '';
  }

  function showBuyGiftCodePopup() {
    const priceTextElement = document.getElementById('buyGiftCodePrice');
    if (balance <= 0) {
      document.getElementById('buyGiftCodeMessage').innerText = `‚ùå You don't have any money to buy a gift code!`;
      document.getElementById('buyGiftCodePopup').style.display = 'flex';
      return;
    }
    const randomPercentage = Math.floor(Math.random() * (90 - 25 + 1)) + 25;
    let price = balance * (randomPercentage / 100);
    
    // NEW: Item price logic (for demonstration, making gift codes cheaper during event)
    if (checkEventStatus()) {
        price *= 0.75; // 25% discount on gift code purchase
    }
    
    priceTextElement.dataset.price = price;
    priceTextElement.innerText = `Price: $${price.toFixed(2)} (${randomPercentage}%)`;
    document.getElementById('buyGiftCodePopup').style.display = 'flex';
  }
  
  function hideBuyGiftCodePopup() {
    document.getElementById('buyGiftCodePopup').style.display = 'none';
    document.getElementById('buyGiftCodeMessage').innerText = '';
  }

  function buyGiftCode() {
    const priceTextElement = document.getElementById('buyGiftCodePrice');
    const price = parseFloat(priceTextElement.dataset.price);
    if (balance <= 0 || balance < price) {
      document.getElementById('buyGiftCodeMessage').innerText = `‚ùå Not enough money! You need $${price.toFixed(2)}.`;
      return;
    }
    balance -= price;
    updateBalance();
    const newCode = Math.random().toString(36).substring(2, 10).toUpperCase();
    
    let successChance = Math.floor(Math.random() * 70) + 10;
    // NEW: Gift code success logic (guarantee a working code during event for demonstration)
    if (checkEventStatus()) {
        successChance = 100; // 100% success chance during the event
    }
    
    boughtGiftCodes.set(newCode, successChance);
    document.getElementById('buyGiftCodeMessage').innerText = `üéâ You bought a gift code for $${price.toFixed(2)}!
    It has a ${successChance}% chance of working.
    Code: ${newCode}`;
    saveGame();
  }

  function redeemGiftCode() {
    const code = document.getElementById('giftCodeInput').value.trim().toLowerCase();
    const messageElement = document.getElementById('giftCodeMessage');
    if (blockedWords.has(code)) {
      messageElement.innerText = "‚ùå That code is invalid.";
      return;
    }
    if (usedGiftCodes.has(code)) {
      messageElement.innerText = "‚ùå You have already redeemed this code!";
      return;
    }
    const dailyCode = "dailygift";
    if (code === dailyCode) {
      balance += 1000;
      usedGiftCodes.add(code);
      updateBalance();
      saveGame();
      messageElement.innerText = `üéâ Success! You received $1000!`;
      return;
    }
    const upperCaseCode = code.toUpperCase();
    if (boughtGiftCodes.has(upperCaseCode)) {
      const successChance = boughtGiftCodes.get(upperCaseCode);
      const randomRoll = Math.floor(Math.random() * 100) + 1;
      
      // NEW: Check for event status and guarantee success
      const successOverride = checkEventStatus();
      
      boughtGiftCodes.delete(upperCaseCode);
      usedGiftCodes.add(upperCaseCode);
      saveGame();
      
      if (randomRoll <= successChance || successOverride) { // Check for override
        let rewardText = "";
        const reward = getRandomReward(balance);
        if (reward.type === 'money') {
          balance += reward.amount;
          rewardText = `You received $${reward.amount}!`;
        } else if (reward.type === 'item') {
          inventory[reward.name] = (inventory[reward.name] || 0) + reward.count;
          rewardText = `You received ${reward.count} x ${reward.name}!`;
        } else if (reward.type === 'gift_code') {
          const newGiftCode = Math.random().toString(36).substring(2, 10).toUpperCase();
          const newSuccessChance = Math.floor(Math.random() * 70) + 10;
          boughtGiftCodes.set(newGiftCode, newSuccessChance);
          rewardText = `You received a new gift code with a ${newSuccessChance}% chance! Code: ${newGiftCode}`;
        }
        updateBalance();
        updateInventory();
        messageElement.innerText = `üéâ Success! The code worked! ${rewardText}`;
        return;
      } else {
        messageElement.innerText = `üôÅ Unlucky! The code had a ${successChance}% chance but it failed. Better luck next time!`;
        return;
      }
    }
    messageElement.innerText = "‚ùå Invalid or expired gift code.";
  }

  function getRandomReward(currentBalance) {
    const roll = Math.random();

    if (roll < 0.05) { // 5% chance
      return { type: 'gift_code' };
    } else if (roll < 0.40) { // 35% chance
      const items = ['Lucky Charm', 'Super Clover', 'Jackpot Gem'];
      const chosenItem = items[Math.floor(Math.random() * items.length)];
      
      let itemCount = 1;
      if (currentBalance > 2000) { itemCount = 2; }
      if (currentBalance > 5000) { itemCount = 3; }
      if (currentBalance > 10000) { itemCount = 5; }
      
      return { type: 'item', name: chosenItem, count: itemCount };
    } else { // 60% chance
      let rewardAmount;
      if (currentBalance < 500) { 
        rewardAmount = Math.floor(Math.random() * 400) + 100;
      } else if (currentBalance < 2000) { 
        rewardAmount = Math.floor(Math.random() * 1500) + 500;
      } else if (currentBalance < 10000) { 
        rewardAmount = Math.floor(Math.random() * 8000) + 2000;
      } else { 
        rewardAmount = Math.floor(Math.random() * 40000) + 10000;
      }
      return { type: 'money', amount: rewardAmount };
    }
  }
  
  // ----------------------------------------------------------------------
  // NEW: Event Time and Countdown Logic
  // ----------------------------------------------------------------------

  /**
   * Checks if the "Happy Hour" event is currently active based on system time.
   * NOTE: This relies on the client's system clock and timezone.
   * @returns {boolean} True if the event is active.
   */
  function checkEventStatus() {
    // Get the current time in the local timezone (browser will convert to CEST/other timezones)
    const now = new Date(); 
    const hours = now.getHours();
    const minutes = now.getMinutes();

    // Convert start and end times to minutes from midnight for easy comparison
    const startMinutes = EVENT_START_HOUR * 60 + EVENT_START_MINUTE;
    const endMinutes = EVENT_END_HOUR * 60 + EVENT_END_MINUTE;
    const currentMinutes = hours * 60 + minutes;

    return currentMinutes >= startMinutes && currentMinutes < endMinutes;
  }
  
  /**
   * Calculates the time remaining until the next event boundary (start or end).
   * @param {Date} now The current Date object.
   * @returns {number} The time difference in milliseconds.
   */
  function getTimeUntilNextBoundary(now) {
    const hours = now.getHours();
    const minutes = now.getMinutes();
    const seconds = now.getSeconds();
    
    const startMinutes = EVENT_START_HOUR * 60 + EVENT_START_MINUTE;
    const endMinutes = EVENT_END_HOUR * 60 + EVENT_END_MINUTE;
    const currentMinutes = hours * 60 + minutes;

    let targetTimeMs;
    let nextBoundaryMinutes;

    if (currentMinutes < startMinutes) {
      // Case 1: Before the event starts (counting down to start)
      nextBoundaryMinutes = startMinutes;
    } else if (currentMinutes >= startMinutes && currentMinutes < endMinutes) {
      // Case 2: During the event (counting down to end)
      nextBoundaryMinutes = endMinutes;
    } else {
      // Case 3: After the event ends (counting down to start of the *next day*)
      nextBoundaryMinutes = startMinutes + 24 * 60; // Start time tomorrow
    }

    const targetDate = new Date(now);
    targetDate.setHours(Math.floor(nextBoundaryMinutes / 60));
    targetDate.setMinutes(nextBoundaryMinutes % 60);
    targetDate.setSeconds(0);
    targetDate.setMilliseconds(0);
    
    // Handle Case 3 adjustment
    if (nextBoundaryMinutes >= 24 * 60) {
        targetDate.setDate(targetDate.getDate() + 1);
    }
    
    return targetDate.getTime() - now.getTime();
  }

  /**
   * Updates the countdown timer display.
   */
  function updateCountdown() {
    const now = new Date();
    isEventActive = checkEventStatus();
    const diffMs = getTimeUntilNextBoundary(now);

    const diffSec = Math.floor(diffMs / 1000);
    const hours = Math.floor(diffSec / 3600);
    const minutes = Math.floor((diffSec % 3600) / 60);
    const seconds = diffSec % 60;
    
    const timeString = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    
    let message;
    let countdownElement = document.getElementById('event-countdown');
    let countdownGameElement = document.getElementById('event-countdown-game');

    if (isEventActive) {
        message = `üî• HAPPY HOUR ACTIVE! Ends in ${timeString}`;
        countdownElement.classList.add('event-active');
        countdownGameElement.classList.add('event-active');
    } else if (diffMs > 24 * 3600 * 1000) {
        message = "Happy Hour is over for today.";
        countdownElement.classList.remove('event-active');
        countdownGameElement.classList.remove('event-active');
    } else {
        message = `üçÄ Happy Hour starts in ${timeString}`;
        countdownElement.classList.remove('event-active');
        countdownGameElement.classList.remove('event-active');
    }
    
    countdownElement.innerText = message;
    countdownGameElement.innerText = message;

    // Schedule the next update
    setTimeout(updateCountdown, 1000);
  }

  // Start the countdown when the page loads
  updateCountdown();

</script>

</body>
</html>

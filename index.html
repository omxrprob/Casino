<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Money Casino Slot</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #222;
      color: #fff;
      margin: 0;
      padding: 20px;
    }

    h1 { margin-top: 20px; }

    #slot-machine {
      font-size: 3em;
      margin: 20px;
    }

    .slot {
      display: inline-block;
      width: 80px;
      height: 80px;
      line-height: 80px;
      margin: 0 10px;
      background: #444;
      border-radius: 10px;
    }

    input, button, select {
      font-size: 1em;
      padding: 10px;
      margin: 10px 5px;
      border: none;
      border-radius: 5px;
    }

    input {
      width: 100px;
      text-align: center;
    }

    #balance {
      margin-top: 20px;
      font-size: 1.5em;
    }

    #shop {
      margin-top: 40px;
      border-top: 2px solid #888;
      padding-top: 20px;
    }

    /* Mute/Unmute button */
    #audioToggle {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 9999;
      background: #555;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px;
      cursor: pointer;
    }
    
    /* Gift code button */
    #giftCodeBtn {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 9999;
      background: #555;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px;
      cursor: pointer;
    }

    /* Popup container */
    .popup-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }

    .popup-content {
      background: #333;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    }
    
    .popup-content h2 {
      margin-top: 0;
    }

    .popup-content input {
      width: 250px;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
</head>
<body>

<div id="yt-audio" style="width:1;height:1;overflow:hidden;">
  <iframe
    id="yt-player"
    width="0"
    height="0"
    src="https://www.youtube.com/embed/qbPszyOUgnk?autoplay=1&loop=1&playlist=qbPszyOUgnk&enablejsapi=1&mute=1"
    frameborder="0"
    allow="autoplay"
  ></iframe>
</div>

<button id="audioToggle" onclick="toggleAudio()">üîá Unmute</button>

<button id="giftCodeBtn" onclick="showGiftCodePopup()">üéÅ Gift Code</button>

<div id="giftCodePopup" class="popup-container" style="display: none;">
  <div class="popup-content">
    <h2>üéÅ Enter Gift Code</h2>
    <input type="text" id="giftCodeInput" placeholder="Enter code here">
    <br>
    <button onclick="redeemGiftCode()">Redeem</button>
    <button onclick="hideGiftCodePopup()">Close</button>
    <p id="giftCodeMessage"></p>
  </div>
</div>

<div id="start-screen" style="text-align:center; margin-top:100px;">
  <h2>üéÆ Welcome to the Casino</h2>
  <button onclick="startNewGame()">Start New Game</button>
  <button onclick="toggleLoadInput()">Play Previous Game</button>

  <div id="load-screen" style="display:none; margin-top: 20px;">
    <input type="text" id="loadCodeInput" placeholder="Paste save code (optional)">
    <button onclick="loadPreviousGame()">Load Game</button>
  </div>
</div>

<div id="game-content" style="display:none;">
  <h1>üé∞ Casino Slot Machine</h1>

  <div>
    <label for="betAmount">Bet Amount: $</label>
    <input type="number" id="betAmount" min="1" value="10">
    <button onclick="spin()">Spin</button>
  </div>

  <div id="slot-machine">
    <div class="slot" id="slot1">‚ùì</div>
    <div class="slot" id="slot2">‚ùì</div>
    <div class="slot" id="slot3">‚ùì</div>
  </div>

  <div id="balance">Balance: $100</div>
  <div id="message"></div>

  <div id="shop">
    <h2>üõí Market</h2>
    <div>
      <select id="shopItem"></select>
      <button onclick="buyItem()">Buy</button>
      <button onclick="sellItem()">Sell</button>
    </div>
    <div id="inventory">Inventory: (empty)</div>
  </div>

  <div>
    <h3>üíæ Save Code:</h3>
    <div id="saveCodeDisplay" style="font-size: 0.8em; color: #aaa; word-break: break-all;"></div>
  </div>
</div>

<script>
  let balance = 100;
  let inventory = {};
  let usedGiftCodes = new Set();
  const symbols = ['üçí', 'üçã', 'üîî', 'üíé', '7Ô∏è‚É£'];
  let isMuted = true;
  // ‚ö†Ô∏è IMPORTANT: Change this to a long, random, and secure string.
  const SECRET_SAVE_KEY = 'YOUR_SECRET_SAVE_KEY_HERE';
  // ‚ö†Ô∏è IMPORTANT: Change this to a long, random, and secure string.
  const SECRET_GIFT_KEY = 'YOUR_SECRET_GIFT_KEY_HERE';


  const shopItems = {
    "Lucky Charm": { base: 50, price: 50 },
    "Super Clover": { base: 100, price: 100 },
    "Jackpot Gem": { base: 200, price: 200 }
  };

  function toggleAudio() {
    const player = document.getElementById("yt-player");
    const button = document.getElementById("audioToggle");

    if (isMuted) {
      // You may need to set a valid YouTube video ID for this to work.
      // E.g., `player.src = "https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1&enablejsapi=1";`
      // Then use `player.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*')`.
      button.innerText = "üîä Mute";
    } else {
      // Muting and pausing would require a valid video ID to be set.
      button.innerText = "üîá Unmute";
    }

    isMuted = !isMuted;
  }

  function startNewGame() {
    balance = 100;
    inventory = {};
    usedGiftCodes = new Set();
    showGameScreen();
  }

  function toggleLoadInput() {
    document.getElementById('load-screen').style.display = 'block';
  }

  // --- New Save System: Load ---
  function loadPreviousGame() {
    const codeInput = document.getElementById("loadCodeInput").value.trim();
    
    try {
      const codeToLoad = codeInput || localStorage.getItem("casinoSave");
      if (!codeToLoad) throw new Error("No save data found");
      
      const [encodedData, signature] = codeToLoad.split(':');
      if (!encodedData || !signature) throw new Error("Invalid save format");

      const decodedData = atob(encodedData);
      const expectedSignature = sha256.hmac(SECRET_SAVE_KEY, decodedData);

      if (signature !== expectedSignature) {
        throw new Error("Invalid or corrupted save code!");
      }

      const data = JSON.parse(decodedData);

      if (!("balance" in data) || !("inventory" in data) || !("usedGiftCodes" in data)) {
        throw new Error("Invalid save data structure");
      }

      balance = data.balance;
      inventory = data.inventory;
      usedGiftCodes = new Set(data.usedGiftCodes);

      showGameScreen();

    } catch (e) {
      alert(`‚ùå Error loading game: ${e.message}`);
    }
  }

  function showGameScreen() {
    document.getElementById('start-screen').style.display = 'none';
    document.getElementById('game-content').style.display = 'block';

    updateBalance();
    updateInventory();
    updateMarketPrices();
    schedulePriceUpdate();
    saveGame();
  }

  function updateBalance() {
    document.getElementById('balance').innerText = `Balance: $${balance}`;
  }

  function updateInventory() {
    const entries = Object.entries(inventory);
    const invText = entries.length
      ? entries.map(([item, count]) => `${item} x${count}`).join(', ')
      : "(empty)";
    document.getElementById('inventory').innerText = "Inventory: " + invText;
  }

  function updateMarketPrices() {
    for (let item in shopItems) {
      const multiplier = 1 + Math.random() * 0.9;
      shopItems[item].price = Math.max(50, Math.min(500, Math.round(shopItems[item].base * multiplier)));
    }
    updateShopDropdown();
  }

  function updateShopDropdown() {
    const select = document.getElementById('shopItem');
    select.innerHTML = '';
    for (let item in shopItems) {
      const price = shopItems[item].price;
      const emoji = item === "Lucky Charm" ? "üéÅ" : item === "Super Clover" ? "üçÄ" : "üíé";
      const option = document.createElement('option');
      option.value = item;
      option.textContent = `${emoji} ${item} - $${price}`;
      select.appendChild(option);
    }
  }

  function buyItem() {
    const itemName = document.getElementById('shopItem').value;
    const itemPrice = shopItems[itemName].price;

    if (balance < itemPrice) {
      alert("You don't have enough money to buy this item.");
      return;
    }

    balance -= itemPrice;
    inventory[itemName] = (inventory[itemName] || 0) + 1;

    updateBalance();
    updateInventory();
    saveGame();
  }

  function sellItem() {
    const items = Object.keys(inventory);
    if (!items.length) {
      alert("You have nothing to sell!");
      return;
    }

    const itemName = items[0];
    const price = shopItems[itemName].price;

    if (inventory[itemName] <= 0) {
      alert("You don't have this item to sell!");
      return;
    }

    inventory[itemName]--;
    if (inventory[itemName] <= 0) delete inventory[itemName];

    balance += price;
    alert(`You sold your ${itemName} for $${price}`);

    updateBalance();
    updateInventory();
    saveGame();
  }

  function spin() {
    const bet = parseInt(document.getElementById('betAmount').value);
    const msg = document.getElementById('message');

    if (isNaN(bet) || bet <= 0) {
      msg.innerText = 'Enter a valid bet amount.';
      return;
    }

    if (balance < bet) {
      msg.innerText = 'Not enough balance!';
      return;
    }

    balance -= bet;

    const boostChance = getBoostMultiplier();

    const roll = () => symbols[Math.floor(Math.random() * symbols.length)];
    let slot1 = roll();
    let slot2 = roll();
    let slot3 = roll();

    if (Math.random() < boostChance) {
      const luckySymbol = symbols[Math.floor(Math.random() * symbols.length)];
      slot1 = slot2 = slot3 = luckySymbol;
    }

    document.getElementById('slot1').innerText = slot1;
    document.getElementById('slot2').innerText = slot2;
    document.getElementById('slot3').innerText = slot3;

    let winnings = 0;

    if (slot1 === '7Ô∏è‚É£' && slot2 === '7Ô∏è‚É£' && slot3 === '7Ô∏è‚É£') {
      winnings = bet * 5;
      msg.innerText = `üî• Triple 7s! You won $${winnings}!`;
    } else if (slot1 === slot2 && slot2 === slot3) {
      winnings = bet * 3.5;
      msg.innerText = `üéâ Jackpot! You won $${winnings.toFixed(2)}!`;
    } else if (slot1 === slot2 || slot2 === slot3 || slot1 === slot3) {
      winnings = bet * 2;
      msg.innerText = `üòä Nice! You won $${winnings}!`;
    } else {
      msg.innerText = 'üôÅ Try again!';
    }

    balance += winnings;
    updateBalance();
    saveGame();
  }

  function getBoostMultiplier() {
    let multiplier = 0;
    for (let item in inventory) {
      const count = inventory[item];
      if (item === "Lucky Charm") multiplier += 0.03 * count;
      if (item === "Super Clover") multiplier += 0.05 * count;
      if (item === "Jackpot Gem") multiplier += 0.08 * count;
    }
    return Math.min(multiplier, 0.7);
  }

  // --- New Save System: Save ---
  function saveGame() {
    const state = {
      balance: balance,
      inventory: inventory,
      usedGiftCodes: Array.from(usedGiftCodes)
    };
    const stateString = JSON.stringify(state);
    const signature = sha256.hmac(SECRET_SAVE_KEY, stateString);
    const code = btoa(stateString) + ':' + signature;
    document.getElementById('saveCodeDisplay').innerText = code;
    localStorage.setItem("casinoSave", code);
  }

  function schedulePriceUpdate() {
    updateMarketPrices();
    setTimeout(schedulePriceUpdate, 5000 + Math.random() * 5000);
  }

  // --- New Gift Code System ---
  function showGiftCodePopup() {
    document.getElementById('giftCodePopup').style.display = 'flex';
  }

  function hideGiftCodePopup() {
    document.getElementById('giftCodePopup').style.display = 'none';
    document.getElementById('giftCodeInput').value = '';
    document.getElementById('giftCodeMessage').innerText = '';
  }

  function redeemGiftCode() {
    const code = document.getElementById('giftCodeInput').value.trim();
    const messageElement = document.getElementById('giftCodeMessage');
    
    if (usedGiftCodes.has(code)) {
      messageElement.innerText = "‚ùå You have already redeemed this code!";
      return;
    }
    
    // The "server-side" logic. The code is generated based on a daily value and a secret key.
    // To change the daily code, simply change the reward and/or the date.
    // To add multiple daily codes, you could have a different dailyCodeData string.
    const today = new Date().toISOString().slice(0, 10);
    const dailyReward = 1000;
    const dailyCodeData = `reward:${dailyReward}|date:${today}`;
    const validDailyCode = sha256.hmac(SECRET_GIFT_KEY, dailyCodeData);

    if (code === validDailyCode) {
      balance += dailyReward;
      usedGiftCodes.add(code);
      updateBalance();
      saveGame();
      messageElement.innerText = `üéâ Success! You received $${dailyReward}!`;
    } else {
      messageElement.innerText = "‚ùå Invalid gift code.";
    }
  }

</script>

</body>
</html>
